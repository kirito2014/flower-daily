generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}


model Flower {
  id           String   @id @default(cuid())
  name         String
  englishName  String?
  alias        String?  // 新增：别名 (不展示，用于搜索，AI更新)
  imageUrl     String
  sourceUrl    String?  // 新增：图片来源链接
  photographer String?  // 新增：拍摄者/版权方
  language     String   // 花语
  habit        String   // 习性
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model AppConfig {
  id        String   @id @default(cuid())
  name      String   @default("Custom AI") // 服务商名称
  baseUrl   String
  apiKey    String   // 加密存储
  modelName String
  isActive  Boolean  @default(false) // 是否激活
  updatedAt DateTime @updatedAt
}
// === 用户模型 (更新) ===
model User {
  id           String   @id @default(uuid())
  username     String   @unique
  password     String
  isFirstLogin Boolean  @default(true)
  lastLogin    DateTime? // 最后登录时间
  isActive     Boolean   @default(true) // 是否启用
  roleId       String?   // 角色ID
  role         Role?     @relation(fields: [roleId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// === 新增：角色模型 ===
model Role {
  id          String   @id @default(uuid())
  name        String   @unique // 角色名称 (如：管理员)
  code        String   @unique // 角色代号 (如：admin)
  description String?
  permissions String   // 存储菜单权限列表的 JSON 字符串，例如 '["flowers", "users"]'
  users       User[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


// 新增：图片服务配置
model ImageConfig {
  id        String   @id @default(cuid())
  name      String   @default("Unsplash") // 服务商名称
  accessKey String   // 加密存储
  secretKey String?  // 加密存储
  provider  String   @default("unsplash")
  isActive  Boolean  @default(false) // 是否激活
  updatedAt DateTime @updatedAt
}

// 新增：系统密钥 (单例)
model SystemKey {
  id        String   @id @default("sys_key")
  key       String   // 当前使用的加密密钥 (明文存储于DB，靠DB权限保护)
  updatedAt DateTime @updatedAt
}